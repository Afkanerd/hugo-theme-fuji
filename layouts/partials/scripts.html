{{ if and (.IsPage) (.Site.Params.utterancesComment) }}
<!-- comment loading indicator -->
<script>
    $(function () {
        var loadingBar = new ProgressBar.Circle("#loading-bar", {
            color: "#8AA2D3",
            strokeWidth: 15,
            trailColor: "#E5E2E4",
            trailWidth: 15,
            fill: "#E5E2E4"
        });
        loadingBar.animate(1.0, {
            duration: 10000
        });

        var commentStatus;
        var commentLoadingTime = 0;
        var commentCheckInterval = self.setInterval(checkUtterances, 500);

        function checkUtterances() {
            commentStatus = $("#post-comment .utterances").attr("style");
            if (commentStatus === undefined) {
                commentLoadingTime += 1;
                if (commentLoadingTime > 20) {
                    clearInterval(commentCheckInterval);
                    $("#post-comment").hide();
                    $("#post-loading p").text('{{ i18n "postCommentLoadingFailed" }}');
                }
                return;
            } else {
                clearInterval(commentCheckInterval);
                loadingBar.animate(1.0, {
                    duration: 500
                }, function () {
                    $("#post-loading").hide();
                });
            }
        }
    });
</script>
{{ end }}
{{ if .Site.Params.scrollTop }}
<!-- scroll to top button -->
<script>
    $(function () {
        var bar = new ProgressBar.Circle("#progress", {
            color: "#8AA2D3",
            strokeWidth: 10,
            trailColor: "#E5E2E4",
            trailWidth: 10,
            text: {
                value: '{{ partial "fas/fa-angle-up" . }}',
                style: null
            },
            fill: "#E5E2E4"
        });
        var scrolled = ($(window).scrollTop() / ($(document).height() - $(window).height() - 1));
        bar.animate(scrolled);
        $(window).scroll(function () {
            scrolled = ($(window).scrollTop() / ($(document).height() - $(window).height() - 1));
            if (scrolled < 0.0005) {
                scrolled = 0;
            } else if (scrolled > 1) {
                scrolled = 1;
            }
            bar.set(scrolled);
        });
    });
    $("#container-progress").click(function () {
        $("html, body").animate({
            scrollTop: 0
        }, "slow");
    });
</script>
{{ end }}
{{ if .Site.Params.webpChecker }}
<!-- webp checker -->
<script>
    $(function () {
        Modernizr.on("webp", function (result) {
            if (!result) {
                $('<blockquote><p>{{ i18n "webpCheckerFront" }}<a href="https://caniuse.com/#feat=webp" target="_blank">WebP</a>{{ i18n "webpCheckerEnd" }}</p></blockquote>')
                    .replaceAll("#content img");
            }
        });
    });
</script>
{{ end }}